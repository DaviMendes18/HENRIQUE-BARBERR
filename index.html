<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Henrique Barber</title>
    <link rel="icon" type="image/png" href="agenda.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #f39c12;
            --bg: #0a0a0b;
            --card: rgba(22, 22, 24, 0.94); 
            --accent: #00d2ff;
            --danger: #e74c3c;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body { 
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), 
                        url('agenda.png'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white; padding: 20px; 
            display: flex; flex-direction: column; 
            align-items: center; margin: 0; min-height: 100vh;
        }

        .brand-header { text-align: center; margin-bottom: 20px; }
        .logo-profile {
            width: 100px; height: 100px; border-radius: 50%;
            border: 2px solid var(--primary); object-fit: cover;
            margin-bottom: 10px; background-color: #000;
        }

        .brand-header h1 { font-size: 24px; color: var(--primary); margin: 0; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; }
        .subtitle { font-size: 13px; color: #888; margin-top: 5px; }
        .phone-sub { font-size: 11px; color: #555; font-weight: 600; margin-top: 4px; }

        .booking-card {
            background: var(--card); padding: 25px; border-radius: 24px;
            width: 100%; max-width: 450px; border: 1px solid #2d2d30;
            backdrop-filter: blur(15px); box-shadow: 0 20px 40px rgba(0,0,0,0.7);
        }

        label { display: block; margin-bottom: 8px; font-size: 11px; font-weight: 700; color: #555; text-transform: uppercase; }
        input, select {
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #333;
            background: #1a1a1c; color: white; margin-bottom: 20px; outline: none;
        }

        .time-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .time-slot {
            padding: 10px; background: #252529; border: 1px solid #333; border-radius: 8px;
            text-align: center; cursor: pointer; font-size: 14px;
        }
        .time-slot.selected { background: var(--primary); color: black; font-weight: bold; }
        .time-slot.occupied { opacity: 0.2; cursor: not-allowed; text-decoration: line-through; }

        .btn-confirm {
            width: 100%; padding: 18px; background: var(--primary); color: black;
            border: none; border-radius: 15px; font-weight: 800; cursor: pointer;
        }

        .history { width: 100%; max-width: 450px; margin-top: 30px; }
        .history h3 { font-size: 13px; color: #555; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 8px; }
        .history-item {
            background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px;
            border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center;
        }
        .history-info b { display: block; font-size: 14px; color: var(--accent); }
        .history-info span { font-size: 11px; color: #666; }

        .btn-delete {
            background: rgba(231, 76, 60, 0.2); color: var(--danger);
            border: none; width: 28px; height: 28px; border-radius: 50%;
            cursor: pointer; font-weight: bold; font-size: 12px; margin-left: 15px;
            display: flex; align-items: center; justify-content: center;
        }

        .footer { margin-top: 40px; font-size: 10px; color: #444; }
    </style>
</head>
<body>

    <div class="brand-header">
        <img src="agenda.png" class="logo-profile" alt="Logo">
        <h1>Henrique Barber</h1>
        <p class="subtitle">@henrique_barberstyle</p>
        <p class="phone-sub">ðŸ“ž 61 98279-7226</p>
    </div>

    <div class="booking-card">
        <label>Nome Completo</label>
        <input type="text" id="nome" placeholder="Seu nome">

        <label>Selecione o ServiÃ§o</label>
        <select id="servico">
            <option value="Corte Masculino (R$ 35,00)">Corte Masculino â€” R$ 35,00</option>
            <option value="Barba (R$ 25,00)">Barba â€” R$ 25,00</option>
            <option value="Combo Corte+Barba (R$ 55,00)">Combo Corte + Barba â€” R$ 55,00</option>
            <option value="Corte + Limpeza de Pele (R$ 50,00)">Corte + Limpeza de Pele â€” R$ 50,00</option>
            <option value="Corte + Barba + Limpeza (R$ 75,00)">Corte + Barba + Limpeza â€” R$ 75,00</option>
            <option value="Barba + Limpeza de Pele e Pezinho (R$ 45,00)">Barba + Limpeza de Pele e Pezinho â€” R$ 45,00</option>
            <option value="Sobrancelha (R$ 15,00)">Sobrancelha â€” R$ 15,00</option>
        </select>

        <label>Data</label>
        <input type="text" id="data" placeholder="Escolha o dia">

        <label>HorÃ¡rios</label>
        <div class="time-grid" id="timeGrid"></div>

        <button class="btn-confirm" onclick="realizarAgendamento()">Confirmar Agendamento</button>
    </div>

    <div class="history">
        <h3>Lista de Agendamentos</h3>
        <div id="listaHistorico"></div>
    </div>

    <div class="footer">DESENVOLVIDO POR <b>NÃ“ DIGITAL</b></div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCxSySECL8x6UGQlqCLC9o0DZ6wFAb0DbM",
            authDomain: "henriquebarber-f9ba4.firebaseapp.com",
            databaseURL: "https://henriquebarber-f9ba4-default-rtdb.firebaseio.com",
            projectId: "henriquebarber-f9ba4",
            storageBucket: "henriquebarber-f9ba4.firebasestorage.app",
            messagingSenderId: "969951925527",
            appId: "1:969951925527:web:9a4879301c72dfe3b0d352",
            measurementId: "G-S45QVR8LVK"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let selectedTime = null;
        const horariosBase = ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00"];

        flatpickr("#data", {
            locale: "pt",
            dateFormat: "d/m/Y",
            minDate: "today",
            onChange: renderTimeSlots
        });

        function renderTimeSlots() {
            const grid = document.getElementById('timeGrid');
            const dataSel = document.getElementById('data').value;
            grid.innerHTML = "";
            selectedTime = null;
            if(!dataSel) return;

            database.ref('agendamentos').once('value', (snapshot) => {
                const agendados = [];
                snapshot.forEach(child => { agendados.push(child.val()); });

                horariosBase.forEach(hora => {
                    const isOccupied = agendados.some(a => a.data === dataSel && a.hora === hora);
                    const div = document.createElement('div');
                    div.className = `time-slot ${isOccupied ? 'occupied' : ''}`;
                    div.innerText = hora;
                    if(!isOccupied) {
                        div.onclick = () => {
                            document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                            div.classList.add('selected');
                            selectedTime = hora;
                        };
                    }
                    grid.appendChild(div);
                });
            });
        }

        function realizarAgendamento() {
            const tel = "5561982797226"; 
            const nome = document.getElementById('nome').value;
            const servico = document.getElementById('servico').value;
            const data = document.getElementById('data').value;

            if (!nome || !data || !selectedTime) {
                alert("Preencha todos os campos!");
                return;
            }

            const novoAgendamento = {
                id: Date.now(),
                nome: nome,
                servico: servico,
                data: data,
                hora: selectedTime
            };

            database.ref('agendamentos/' + novoAgendamento.id).set(novoAgendamento)
                .then(() => {
                    const texto = `ðŸ’ˆ *AGENDAMENTO*\nðŸ‘¤ *Cliente:* ${nome}\nâœ‚ï¸ *ServiÃ§o:* ${servico}\nðŸ“… *Data:* ${data}\nâ° *Hora:* ${selectedTime}`;
                    const msg = encodeURIComponent(texto);
                    
                    // Usando o link da API do WhatsApp que costuma ser mais estÃ¡vel para disparos
                    const url = `https://api.whatsapp.com/send?phone=${tel}&text=${msg}`;
                    
                    window.open(url, '_blank');

                    // Limpa os campos em vez de dar reload para nÃ£o travar a abertura do link
                    alert("Agendamento salvo e enviado para o Henrique!");
                    document.getElementById('nome').value = "";
                    selectedTime = null;
                    renderTimeSlots();
                })
                .catch(err => {
                    alert("Erro ao salvar no banco de dados.");
                });
        }

        function excluirAgendamento(id) {
            const senhaDono = "1234"; 
            const senhaDigitada = prompt("Acesso Restrito: Digite a senha para excluir:");

            if (senhaDigitada === senhaDono) {
                if(confirm("Deseja remover este agendamento?")) {
                    database.ref('agendamentos/' + id).remove();
                }
            } else if (senhaDigitada !== null) {
                alert("Senha incorreta!");
            }
        }

        database.ref('agendamentos').on('value', (snapshot) => {
            const lista = document.getElementById('listaHistorico');
            let db = [];
            snapshot.forEach(child => { db.push(child.val()); });
            
            db.sort((a, b) => {
                const d1 = a.data.split('/').reverse().join('');
                const d2 = b.data.split('/').reverse().join('');
                return d1 !== d2 ? d1.localeCompare(d2) : a.hora.localeCompare(b.hora);
            });

            lista.innerHTML = db.length === 0 ? "<p style='color:#444; font-size:11px;'>Sem agendamentos.</p>" : "";

            db.forEach(ag => {
                lista.innerHTML += `
                    <div class="history-item">
                        <div class="history-info">
                            <b>${ag.nome}</b>
                            <span>${ag.servico}</span>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <div style="text-align:right">
                                <div style="font-size:14px; font-weight:bold; color: var(--primary);">${ag.hora}</div>
                                <div style="font-size:10px; color:#555">${ag.data}</div>
                            </div>
                            <button class="btn-delete" onclick="excluirAgendamento(${ag.id})">X</button>
                        </div>
                    </div>
                `;
            });
        });
    </script>
</body>
</html>

